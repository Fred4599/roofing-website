---
import { siteConfig } from '../config/site';

interface Props {
  title: string;
  description: string;
  canonicalPath: string;
  ogImage?: string;
  noindex?: boolean;
  schema?: object | object[];
  ogType?: 'website' | 'article';
}

const {
  title,
  description,
  canonicalPath,
  ogImage = siteConfig.defaultOgImage,
  noindex = false,
  schema,
  ogType = 'website',
} = Astro.props;

const canonicalUrl = `${siteConfig.siteUrl}${canonicalPath}`;
const ogImageUrl = ogImage.startsWith('http') ? ogImage : `${siteConfig.siteUrl}${ogImage}`;
const fullTitle = canonicalPath === '/' ? `${title} | ${siteConfig.siteName}` : `${title} | ${siteConfig.siteName}`;

// Default LocalBusiness schema for all pages
const defaultLocalBusinessSchema = {
  '@context': 'https://schema.org',
  '@type': ['LocalBusiness', 'RoofingContractor'],
  name: siteConfig.siteName,
  image: ogImageUrl,
  telephone: siteConfig.phone,
  email: siteConfig.email,
  address: {
    '@type': 'PostalAddress',
    streetAddress: siteConfig.address.street,
    addressLocality: siteConfig.address.city,
    addressRegion: siteConfig.address.state,
    postalCode: siteConfig.address.zip,
    addressCountry: 'US',
  },
  areaServed: siteConfig.serviceAreas.map((area) => ({
    '@type': 'City',
    name: area.name,
    '@id': `https://en.wikipedia.org/wiki/${area.name},_Idaho`,
  })),
  url: siteConfig.siteUrl,
  priceRange: '$$',
  openingHoursSpecification: [
    {
      '@type': 'OpeningHoursSpecification',
      dayOfWeek: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
      opens: '07:00',
      closes: '18:00',
    },
    {
      '@type': 'OpeningHoursSpecification',
      dayOfWeek: 'Saturday',
      opens: '08:00',
      closes: '16:00',
    },
  ],
};

const schemas = schema ? (Array.isArray(schema) ? schema : [schema]) : [];
const allSchemas = [defaultLocalBusinessSchema, ...schemas];
---

<!-- Primary Meta Tags -->
<title>{fullTitle}</title>
<meta name="title" content={fullTitle} />
<meta name="description" content={description} />
<link rel="canonical" href={canonicalUrl} />

{noindex && <meta name="robots" content="noindex, nofollow" />}

<!-- Open Graph / Facebook -->
<meta property="og:type" content={ogType} />
<meta property="og:url" content={canonicalUrl} />
<meta property="og:title" content={fullTitle} />
<meta property="og:description" content={description} />
<meta property="og:image" content={ogImageUrl} />
<meta property="og:site_name" content={siteConfig.siteName} />
<meta property="og:locale" content="en_US" />

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:url" content={canonicalUrl} />
<meta property="twitter:title" content={fullTitle} />
<meta property="twitter:description" content={description} />
<meta property="twitter:image" content={ogImageUrl} />

<!-- Geo Tags for Local SEO -->
<meta name="geo.region" content="US-ID" />
<meta name="geo.placename" content="Boise, Idaho" />

<!-- Schema.org JSON-LD -->
{allSchemas.map((schemaItem) => (
  <script type="application/ld+json" set:html={JSON.stringify(schemaItem)} />
))}
